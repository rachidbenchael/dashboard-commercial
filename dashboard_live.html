<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Commercial Live</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; background:#f4f6f9; padding:20px; }
h1 { text-align:center; margin-bottom:30px; color:#333; }
.card { background:white; padding:20px; border-radius:10px; margin-bottom:30px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#007bff; color:white; }
.green{color:green;font-weight:bold;}
.orange{color:orange;font-weight:bold;}
.red{color:red;font-weight:bold;}
</style>
</head>
<body>

<h1>ðŸ“Š Dashboard Commercial Live</h1>

<div class="card">
<h3>ðŸ“ˆ Taux dâ€™atteinte (Calcul)</h3>
<table id="tableCalcul"></table>
</div>

<div class="card">
<h3>ðŸŽ¯ Objectifs</h3>
<table id="tableObjectifs"></table>
</div>

<div class="card">
<h3>ðŸš€ RÃ©alisations</h3>
<table id="tableRealisations"></table>
</div>

<div class="card">
<h3>ðŸ“Š Graphique Total BiÃ¨res vs Total Vin</h3>
<canvas id="chart"></canvas>
</div>

<script>
const appsScriptURL = "https://script.google.com/macros/s/AKfycbyY_2grKmI_-_bdL1-lVJwQfNWkyoRFqIXr88r8VAYN-3xhE2atl6038A6vJ1Vk_o1Ykw/exec"; // remplace ici

function fillTable(data, tableId, isPercent=false){
    const table = document.getElementById(tableId);
    table.innerHTML = "";
    if(!data || data.length===0) return;
    let headerRow = "<tr>";
    Object.keys(data[0]).forEach(k=> headerRow += `<th>${k}</th>`);
    headerRow += "</tr>";
    table.innerHTML += headerRow;
    data.forEach(row=>{
        let rowHTML = "<tr>";
        Object.values(row).forEach(cell=>{
            if(isPercent && typeof cell==="number"){
                let color = cell >= 100 ? "green" : (cell >= 80 ? "orange" : "red");
                rowHTML += `<td class="${color}">${cell.toFixed(2)}%</td>`;
            } else {
                rowHTML += `<td>${cell}</td>`;
            }
        });
        rowHTML += "</tr>";
        table.innerHTML += rowHTML;
    });
}

// Charger les donnÃ©es live depuis Apps Script
fetch(appsScriptURL)
.then(res=>res.json())
.then(json=>{
    fillTable(json.Calcul,"tableCalcul",true);
    fillTable(json.Objectifs,"tableObjectifs");
    fillTable(json.RÃ©alisations,"tableRealisations");

    // Graphique
    const labels = json.Calcul.map(r=>r.Commerciale);
    const totalB = json.Calcul.map(r=>r["Total BiÃ¨res"]);
    const totalV = json.Calcul.map(r=>r["Total Vin"]);

    new Chart(document.getElementById("chart"),{
        type:"bar",
        data:{
            labels:labels,
            datasets:[
                {label:"Total BiÃ¨res", data:totalB, backgroundColor:"rgba(54,162,235,0.7)"},
                {label:"Total Vin", data:totalV, backgroundColor:"rgba(255,99,132,0.7)"}
            ]
        },
        options:{responsive:true, plugins:{legend:{position:"top"}}, scales:{y:{beginAtZero:true}}}
    });
})
.catch(err=>console.error("Erreur fetch Apps Script :", err));
</script>

</body>
</html>
